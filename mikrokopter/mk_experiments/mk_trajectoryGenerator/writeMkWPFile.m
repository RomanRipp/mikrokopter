function writeMkWPFile(waypoints, varargin)

p = inputParser;
defaultCenter = - 1;
defaultName = 'void';
defaultHSpeed = 3;
defaultVSpeed = 3;

addRequired(p,'waypoints',@isnumeric);
addOptional(p,'center',defaultCenter ,@isnumeric);
addOptional(p,'name',defaultName ,@ischar);
addOptional(p,'hspeed',defaultHSpeed ,@isnumeric);
addOptional(p,'vspeed',defaultVSpeed ,@isnumeric);

parse(p,waypoints,varargin{:});
wps = p.Results.waypoints;
cntr = p.Results.center;
name = p.Results.name;
hspeed = p.Results.hspeed;
vspeed = p.Results.vspeed;

lat = wps(:,1);
lon = wps(:,2);
alt = wps(:,3);

waypointCount = length(alt);
%write mikrokopter waypoints

path = fileparts(which('writeMkWPFile'));
filename = [name,'WPs-',num2str(waypointCount),'.wpl'];
fullname = fullfile(path, 'trajectories', filename)
fileID = fopen(fullname,'w');

if (cntr ~= -1)
    fprintf(fileID,'[General]\nFileVersion=3\nNumberOfWaypoints=%d\n',waypointCount+1);
    fprintf(fileID,['[Point1]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%f\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=-1\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=2\n' ...
        'Prefix=0\n'], cntr(1), cntr(2), 0, vspeed*10, hspeed*10);

    for index = 1:waypointCount
        fprintf(fileID,['[Point%d]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%f\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=-1\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=1\n' ...
        'Prefix=P\n'], index+1, lat(index), lon(index), alt(index),vspeed*10, hspeed*10);
    end
else
    fprintf(fileID,'[General]\nFileVersion=3\nNumberOfWaypoints=%d\n',waypointCount);
    for index = 1:waypointCount
        fprintf(fileID,['[Point%d]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%f\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=-1\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=1\n' ...
        'Prefix=P\n'], index, lat(index), lon(index), alt(index),vspeed*10, hspeed*10);
    end

end
fclose(fileID);

