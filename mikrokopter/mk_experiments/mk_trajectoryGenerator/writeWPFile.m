function writeWPFile(waypoints, varargin)

p = inputParser;
defaultCenter = - 1;
defaultName = 'void';
defaultHSpeed = 3;
defaultVSpeed = 1;

addRequired(p,'waypoints',@isnumeric);
addOptional(p,'center',defaultCenter ,@isnumeric);
addOptional(p,'name',defaultName ,@ischar);
addOptional(p,'hspeed',defaultHSpeed ,@isnumeric);
addOptional(p,'vspeed',defaultVSpeed ,@isnumeric);

parse(p,waypoints,varargin{:});
wps = p.Results.waypoints;
cntr = p.Results.center;
name = p.Results.name;
hspeed = p.Results.hspeed;
vspeed = p.Results.vspeed;

lat = wps(:,1);
lon = wps(:,2);
alt = int8(wps(:,3));

waypointCount = length(alt);
%write mikrokopter waypoints

path = fileparts(which('writeWPFile'));
filename = [name, ...
    'WPs-', num2str(waypointCount), ...
    'h-',num2str(hspeed),...
    'v-',num2str(vspeed),...
    '.wpl'];
fullname = fullfile(path, 'trajectories', filename)
fileID = fopen(fullname,'w');

if (cntr ~= -1)
    heading = -1;
    fprintf(fileID,'[General]\nFileVersion=3\nNumberOfWaypoints=%d\n',waypointCount+1);
    fprintf(fileID,['[Point1]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%d\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=%d\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=2\n' ...
        'Prefix=0\n'], cntr(1), cntr(2), 0, vspeed*10,heading, hspeed*10);

    for index = 1:waypointCount
        fprintf(fileID,['[Point%d]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%d\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=%d\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=1\n' ...
        'Prefix=P\n'], index+1, lat(index), lon(index), alt(index),vspeed*10,heading, hspeed*10);
    end
else
    fprintf(fileID,'[General]\nFileVersion=3\nNumberOfWaypoints=%d\n',waypointCount);
    heading = 0;
    for index = 1:waypointCount
        fprintf(fileID,['[Point%d]\n' ...
        'Latitude = %f\n' ...
        'Longitude = %f\n' ...
        'Radius=5\n' ...
        'Altitude=%d\n' ...
        'ClimbRate=%d\n' ...
        'DelayTime=0\n' ...
        'WP_Event_Channel_Value=100\n' ...
        'Heading=%d\n' ...
        'Speed=%d\n' ...
        'CAM-Nick=-1\n' ...
        'Type=1\n' ...
        'Prefix=P\n'], index, lat(index), lon(index), alt(index),vspeed*10,heading, hspeed*10);
    end

end
fclose(fileID);

filename = [name,...
    'WPs-',num2str(waypointCount),...
    'h-',num2str(hspeed),...
    'v-',num2str(vspeed),...
    '.sh'];
fullname = fullfile(path, 'trajectories', filename)
fileID = fopen(fullname,'w');

%{
rosservice call /mikrokopter/commands/setwp -- 
    [index] 
    [latitude] 
    [longitude] 
    [height] 
    [status] 
    [holdtime] 
    [elevationSpeed(m/s)] 
    [groundSpeed(m/s)]

    [heading]
    [toleranceRadius]
    [eventChannel]
    [eventFlag]
    [type]
    [camAngle]
%}


fprintf(fileID,'#!/bin/sh\n');
%TODO erase waypoints 
if (cntr ~= -1)
    heading = -1;
    fprintf(fileID,'rosservice call /mikrokopter/commands/setwp -- %d %f %f %f %d %d %f %f %f %d %d %d %d %d \n', ...
        1, ...
        cntr(1), ...
        cntr(2), ...
        0, ...
        1, ...
        0, ...
        vspeed, ...
        hspeed, ...
        heading, ...
        3, ...
        100, ...
        1, ...
        1, ...
        -1);

    for index = 1:waypointCount
        %rosservice call /mikrokopter/commands/setwp -- 1 44.970758 -93.236391 7 1 1 1.0 2.0
        fprintf(fileID,'rosservice call /mikrokopter/commands/setwp -- %d %f %f %f %d %d %f %f %f %d %d %d %d %d \n', ...
            index+1, ...
            lat(index), ...
            lon(index), ...
            alt(index), ...
            1, ...
            0, ...
            vspeed, ...
            hspeed, ...
            heading, ...
            3, ...
            100, ...
            1, ...
            0, ...
            -1);
    end
else
        heading = 0;
        for index = 1:waypointCount
        %rosservice call /mikrokopter/commands/setwp -- 1 44.970758 -93.236391 7 1 1 1.0 2.0
        fprintf(fileID,'rosservice call /mikrokopter/commands/setwp -- %d %f %f %f %d %d %f %f %f %d %d %d %d %d \n', index, ...
                        lat(index), ...
                        lon(index), ...
                        alt(index), ...
                        1, ...
                        0, ...
                        vspeed, ...
                        hspeed, ...
                        heading, ...
                        3, ...
                        100, ...
                        1, ...
                        0, ...
                        -1);
    end
end
fclose(fileID);




